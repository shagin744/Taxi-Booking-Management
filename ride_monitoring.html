<!DOCTYPE html>
<html>
<head>
    <title>Ride Monitoring with Live Location</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
        h2 { color: #2c3e50; }
        .ride-card {
            margin-bottom: 30px; 
            background: #fff; 
            padding: 15px; 
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .map { width: 100%; height: 250px; margin-top: 10px; border-radius: 8px; }
        .status-ongoing { color: #27ae60; font-weight: bold; }
        .status-cancelled { color: #e74c3c; font-weight: bold; }
        .status-completed { color: #2980b9; font-weight: bold; }
        .status-pending { color: #f39c12; font-weight: bold; }
    </style>
</head>
<body>
    <h2>ðŸš– Ride Monitoring (with Live Location)</h2>

    <!-- Loop rides -->
    {% for ride in rides %}
        <div class="ride-card">
            <h3>Ride: {{ ride._id }}</h3>
            <p><b>User:</b> {{ ride.user }} | <b>Driver:</b> {{ ride.driver }}</p>
            <p><b>Pickup:</b> {{ ride.pickup }} â†’ <b>Drop:</b> {{ ride.drop }}</p>
            <p><b>Fare:</b> â‚¹{{ ride.final_fare }} | 
               <b>Status:</b> <span class="status-{{ ride.status|lower }}">{{ ride.status }}</span>
            </p>
            <div id="map-{{ ride._id }}" class="map"></div>
        </div>
    {% endfor %}

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}"></script>

    <!-- Store rides JSON safely -->
    <script id="rides-data" type="application/json">
        {{ rides|tojson|safe }}
    </script>

    <script>
        function initMap() {
            // Parse rides JSON
            const rides = JSON.parse(document.getElementById("rides-data").textContent);

            rides.forEach(ride => {
                if (ride.driver_location) {
                    const driverLoc = { 
                        lat: ride.driver_location.lat, 
                        lng: ride.driver_location.lng 
                    };

                    const map = new google.maps.Map(
                        document.getElementById(`map-${ride._id}`), {
                            zoom: 14,
                            center: driverLoc
                        }
                    );

                    new google.maps.Marker({
                        position: driverLoc,
                        map: map,
                        title: "Driver Location"
                    });
                }
            });
        }

        window.onload = initMap;
    </script>
</body>
</html>
